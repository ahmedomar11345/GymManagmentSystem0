@model GymManagmentBLL.ViewModels.WalkInViewModel.CreateWalkInViewModel
@inject IStringLocalizer<SharedResource> Localizer
@{
    ViewData["Title"] = Localizer["WalkInBooking"];
    var currency = ViewBag.Currency as string ?? "EGP";
}

<div class="container-fluid py-4">
    <div class="row justify-content-center">
        <div class="col-lg-7">

            <!-- Header -->
            <div class="d-flex align-items-center mb-4 gap-3">
                <a asp-action="Index" class="btn btn-outline-secondary btn-sm rounded-pill px-3">
                    <i class="fas fa-arrow-right me-1"></i> @Localizer["Back"]
                </a>
                <div>
                    <h4 class="mb-0 fw-bold">
                        <i class="fas fa-walking text-primary me-2"></i>@Localizer["WalkInBooking"]
                    </h4>
                    <small class="text-muted">@Localizer["ManageGymIdentityAndSystemPreferences"]</small>
                </div>
            </div>

            <form asp-action="Create" method="post" id="walkInForm">
                @Html.AntiForgeryToken()
                <input type="hidden" asp-for="MemberId" />

                <div class="card shadow-sm border-0 rounded-4">
                    <div class="card-header bg-primary text-white rounded-top-4 py-3">
                        <h6 class="mb-0"><i class="fas fa-user-plus me-2"></i>@Localizer["BasicInformation"]</h6>
                    </div>
                    <div class="card-body p-4">

                        <!-- Name -->
                        <div class="mb-3">
                            <label asp-for="GuestName" class="form-label fw-semibold">
                                <i class="fas fa-user text-muted me-1"></i> @Localizer["Name"] <span class="text-danger">*</span>
                            </label>
                            <input asp-for="GuestName" class="form-control form-control-lg rounded-3"
                                   placeholder="@Localizer["FullNamePlaceholder"]" autofocus />
                            <span asp-validation-for="GuestName" class="text-danger small"></span>
                        </div>

                        <!-- Phone -->
                        <div class="mb-4">
                            <label asp-for="GuestPhone" class="form-label fw-semibold">
                                <i class="fas fa-phone text-muted me-1"></i> @Localizer["Phone"] <span class="text-danger">*</span>
                            </label>
                            <input asp-for="GuestPhone" class="form-control form-control-lg rounded-3"
                                   placeholder="@Localizer["PhonePlaceholder"]" dir="ltr" />
                            <span asp-validation-for="GuestPhone" class="text-danger small"></span>
                        </div>

                        <hr class="my-3" />

                        <!-- Session Count + Price -->
                        <div class="row g-3 mb-3">
                            <div class="col-6">
                                <label asp-for="SessionCount" class="form-label fw-semibold">
                                    <i class="fas fa-dumbbell text-muted me-1"></i> @Localizer["SessionCount"] <span class="text-danger">*</span>
                                </label>
                                <input asp-for="SessionCount" type="number" min="1" max="100"
                                       class="form-control form-control-lg rounded-3 text-center fw-bold"
                                       id="sessionCount" />
                                <span asp-validation-for="SessionCount" class="text-danger small"></span>
                            </div>
                            <div class="col-6">
                                <label asp-for="PricePerSession" class="form-label fw-semibold">
                                    <i class="fas fa-tag text-muted me-1"></i> @Localizer["SessionPrice"] (@currency)
                                </label>
                                <input asp-for="PricePerSession" type="number" step="0.01" min="0"
                                       class="form-control form-control-lg rounded-3 text-center"
                                       id="pricePerSession" />
                                <span asp-validation-for="PricePerSession" class="text-danger small"></span>
                            </div>
                        </div>

                        <!-- Total Display -->
                        <div class="alert alert-primary rounded-3 text-center py-3 mb-3" id="totalDisplay">
                            <div class="text-muted small mb-1">@Localizer["TotalAmount"]</div>
                            <div class="fs-2 fw-black text-primary" id="totalAmount">0.00</div>
                            <div class="text-muted small">@currency</div>
                        </div>

                        <!-- Notes -->
                        <div class="mb-2">
                            <label asp-for="Notes" class="form-label fw-semibold text-muted">
                                <i class="fas fa-sticky-note me-1"></i> @Localizer["Notes"] (@Localizer["Optional"])
                            </label>
                            <textarea asp-for="Notes" class="form-control rounded-3" rows="2"
                                      placeholder="..."></textarea>
                        </div>

                    </div>
                    <div class="card-footer bg-transparent border-0 p-4 pt-0">
                        <button type="submit" class="btn btn-primary btn-lg w-100 rounded-3 fw-bold">
                            <i class="fas fa-check-circle me-2"></i> @Localizer["Confirm"] & @Localizer["PrintReceipt"]
                        </button>
                    </div>
                </div>
            </form>

        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        const sessionCountEl = document.getElementById('sessionCount');
        const priceEl = document.getElementById('pricePerSession');
        const totalEl = document.getElementById('totalAmount');

        function updateTotal() {
            const count = parseFloat(sessionCountEl.value) || 0;
            const price = parseFloat(priceEl.value) || 0;
            totalEl.textContent = (count * price).toFixed(2);
        }

        sessionCountEl.addEventListener('input', updateTotal);
        priceEl.addEventListener('input', updateTotal);
        updateTotal();
    </script>
}
